# 第三章 研究数据与方法
## 3.1 研究范围
(1)空间范围
上海是世界上共享单车投放量最大的城市之一
上海是中国经济最发达的城市之一，也是中国首批共享单车的投放地．截至 2017 年 9 月底，先后有 13 家公司在上海进行共享单车投放，投放总量超过 115 万量，注册的用户超过 500 万．在当时，共享单车投放量与使用量最大的企业是摩拜，大约投放了 67 万辆，约占比 58%，在共享单车的市场处于主导地位．
(2)时间范围

## 3.2 数据来源与预处理

### 3.2.1 数据来源与数据清洗
本文的研究数据包括骑行轨迹数据与上海市基本地理信息数据，其中骑行轨迹包括由互联网采集整理得到的 2016 年 8 月整月 102361 条上海市某品牌共享单车骑行轨迹数据及 2020 年 8 月整月 12793 条骑行记录，上海市基本地理信息数据包括由 Open  Street  Map 开源地理信息数据网站获取上海市路网矢与兴趣点分布矢量数据及由高德地图开放平台获取的上海市矢量边界数据。

2016 年骑行记录较为详细，除了常见的骑行起止时间及起止点位置字段外，还包含了一个以“#”分隔的骑行轨迹点集字段，但是由于网络延迟、设备故障等原因该字段内的轨迹点为乱序排列，需要设计算法以恢复正确的骑行轨迹（具体方法见 3.2.2），并且骑行实际距离也需要根据正确的轨迹数据计算（计算方法见 3.2.4）。2020 年骑行记录并未包含详细的骑行轨迹点集，但提供骑行距离。对于骑行记录数据，按照如下规则清洗：1）去除骑行时长小于1分钟大于 10 小时的骑行记录；2）对于有轨迹点集的数据，去除记录到的轨迹点数量小于 3 个的记录；3）去除存在字段缺失及异常符号的记录；4）去除骑行终点位于上海市之外的记录，该记录超出研究区域。

上海市基本地理信息数据的预处理使用 QGIS 软件处理，首先使用 QGIS 软件解析 Open  Street  Map 网站内部格式（ *.OSM ）的矢量数据将其转换为常用的 shapefile 文件格式( *.shp )并使用上海市矢量边界数据裁剪掉区域外的部分。

### 3.2.2 基于 GeoHash 算法及曼哈顿距离的轨迹重建算法

### 3.2.3 基于球形墨卡托投影及道格拉斯-扑克法的轨迹简化算法

### 3.2.4 使用 Haversine 算法计算骑行距离

## 3.3 研究方法

## 3.6 本章小结